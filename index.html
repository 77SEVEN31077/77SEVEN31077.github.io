<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ’ä¾¿ç´€éŒ„æ—¥æ›†</title>
    
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #calendar-container {
            background: #fff;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 800px;
        }

        h1 { color: #5D4037; margin-bottom: 10px; }

        /* è‡ªå®šç¾©äº‹ä»¶é¡è‰² (æ£•è‰²) */
        .fc-event {
            background-color: #8B4513 !important;
            border: none !important;
            color: white !important;
            padding: 2px 4px;
            cursor: pointer;
        }

        /* èª¿æ•´æ—¥æ›†æ¨™é¡Œ */
        .fc-toolbar-title { font-size: 1.25em !important; color: #5D4037; }
        
        /* å½ˆçª—å…§è¼¸å…¥æ¡†æ¨£å¼ */
        .swal-input-label { display: block; margin-top: 15px; font-weight: bold; text-align: left; }
    </style>
</head>
<body>

    <h1>ğŸ’© æ’ä¾¿ç´€éŒ„æ—¥æ›†</h1>

    <div id="calendar-container">
        <div id="calendar"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calendarEl = document.getElementById('calendar');

            // å¾ç€è¦½å™¨æœ¬åœ°å„²å­˜è®€å–è³‡æ–™
            let savedEvents = JSON.parse(localStorage.getItem('poopLogs')) || [];

            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'zh-tw',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek'
                },
                events: savedEvents,

                // é»æ“Šæ—¥æ›†æ—¥æœŸ
                dateClick: async function(info) {
                    const { value: formValues } = await Swal.fire({
                        title: 'æ–°å¢ç´€éŒ„',
                        html:
                            `<label class="swal-input-label">é¸æ“‡æ—¥æœŸï¼š</label>` +
                            `<input id="swal-date" type="date" class="swal2-input" value="${info.dateStr}">` +
                            `<label class="swal-input-label">é¸æ“‡æ™‚é–“ï¼š</label>` +
                            `<input id="swal-time" type="time" class="swal2-input" value="${getCurrentTime()}">`,
                        focusConfirm: false,
                        showCancelButton: true,
                        confirmButtonText: 'å„²å­˜',
                        cancelButtonText: 'å–æ¶ˆ',
                        preConfirm: () => {
                            return {
                                date: document.getElementById('swal-date').value,
                                time: document.getElementById('swal-time').value
                            }
                        }
                    });

                    if (formValues) {
                        const newEvent = {
                            title: 'ğŸ’© æ’ä¾¿',
                            start: `${formValues.date}T${formValues.time}:00`,
                            allDay: false
                        };

                        // åŠ å…¥æ—¥æ›†
                        calendar.addEvent(newEvent);

                        // å„²å­˜è‡³æœ¬åœ°
                        savedEvents.push(newEvent);
                        localStorage.setItem('poopLogs', JSON.stringify(savedEvents));
                        
                        Swal.fire({ icon: 'success', title: 'å·²å„²å­˜', timer: 1000, showConfirmButton: false });
                    }
                },

                // é»æ“Šç¾æœ‰ç´€éŒ„å¯åˆªé™¤
                eventClick: function(info) {
                    Swal.fire({
                        title: 'åˆªé™¤ç´€éŒ„ï¼Ÿ',
                        text: `æ™‚é–“ï¼š${info.event.start.toLocaleString()}`,
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#d33',
                        confirmButtonText: 'åˆªé™¤',
                        cancelButtonText: 'å–æ¶ˆ'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            // å¾æ—¥æ›†ç§»é™¤
                            info.event.remove();
                            // å¾å„²å­˜ä¸­ç§»é™¤
                            savedEvents = savedEvents.filter(e => e.start !== info.event.startStr);
                            localStorage.setItem('poopLogs', JSON.stringify(savedEvents));
                        }
                    });
                }
            });

            calendar.render();

            function getCurrentTime() {
                const now = new Date();
                return now.getHours().toString().padStart(2, '0') + ':' + 
                       now.getMinutes().toString().padStart(2, '0');
            }
        });
    </script>

</body>
</html>
